<!DOCTYPE html>
<html>
    <head>
        <title>Feed - KaffIt</title>
        <link rel="stylesheet" href="/gui/style.css">
        <script type="module">
            import { createApp } from 'https://unpkg.com/petite-vue?module';
            
            function Post(props) {
                return {
                    $template: '#post-template',
                    creator: props.creator,
                    text: props.text,
                    timestamp: correctTimestamp(props.timestamp)
                    // Timestamp and Sticker
                }
            }

            function correctTimestamp(timestamp) {
                let year = timestamp.substring(0,4);
                let month = timestamp.substring(5,7);
                let day = timestamp.substring(8,10);
                return `${day}.${month}.${year}`;
            }

            createApp({
                handle: "test",
                posts: [],
                get loginorprofile() {
                    return 'Login'
                },
                get getuser() {
                    /*(async () => {
                        let response = await fetch("/api/user");
                        let parsed = await response.json();
                        this.handle = parsed.handle;
                    })()*/
                    return this.handle
                },
                get fetchposts() {
                    let res;
                    fetch("/api/feed")
                        .then(res => res.json())
                        .then(data => {
                            this.posts = data;
                            return this.posts;
                        });
                },
                Post
            }).mount()
        </script>
        <template id ="post-template">
            <p ><a href="" class="username">{{ creator }}</a></p>
            <p>{{ timestamp }}</p>
            <p>{{ text }}</p>
        </template>
    </head>
    <body>
        <div v-scope class="content">
            <div id=#navbar>
                <ul>
                    <li><a href="feed">Feed</a></li>
                    <li><a href="createpost">Post</a></li>
                    <li><a href="login">Profile</a></li>
                </ul>
            </div>
            <div id="posts" v-for="post in posts">
                <div class="contentbox" v-scope="Post({ creator: post.creator, text: post.text, timestamp: post.timestamp })"></div>
            </div>
          </div>
    </body>
</html>