<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Feed - KaffIt</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
        <link href="/gui/feed.css" rel="stylesheet">
        <link href="/gui/offcanvas-navbar.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <script type="module">
            import { createApp } from 'https://unpkg.com/petite-vue?module';
            import Navbar from '/gui/navbar.js';

            function Post(props) {
                console.log(props.ppformat);
                return {
                    $template: '#post-template',
                    handle: props.handle,
                    text: props.text,
                    timestamp: correctTimestamp(props.timestamp)
                    // Timestamp and Sticker
                }
            }

            function correctTimestamp(timestamp) {
                let year = timestamp.substring(0,4);
                let month = timestamp.substring(5,7);
                let day = timestamp.substring(8,10);
                return `${day}.${month}.${year}`;
            }

            createApp({
                posts: [],
                get loginorprofile() {
                    return 'Login'
                },
                get fetchposts() {
                    let res;
                    fetch("/api/feed")
                        .then(res => res.json())
                        .then(data => {
                            this.posts = data;
                            return this.posts;
                        });
                },
                Navbar,
                Post
            }).mount()
        </script>

        <template id ="post-template">
            <div class="my-3 p-3 bg-body rounded shadow-sm">
                <div class="d-flex border-bottom text-body-secondary pt-3">
                    <img class="flex-shrink-0 me-2 rounded" width="32" height="32" :src="`/profilepictures/${handle}`" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect></img>
                    <div class="pb-3 mb-0 small lh-sm  w-100">
                        <div class="d-flex justify-content-between">
                          <strong class="text-gray-dark">{{ handle }}</strong>
                          <a href="#">Follow</a>
                        </div>
                        <span class="d-block">{{ timestamp }}</span>
                </div>
            </div>

            <div class="d-flex text-body-secondary pt-3">
                <p style="white-space: pre-wrap;" class="pb-3 mb-0 small lh-sm w-100">{{ text }}</p>
            </div>
        </template>

    </head>
    <body class="bg-body-tertiary" v-scope>
        <!-- Image and text -->
            <div v-scope="Navbar({ page: 'Home' })"></div>
            <main class="container">
                <div class="row" id="posts" v-for="post in posts">
                    <div class="col" v-scope="Post({ handle: post.handle, text: post.text, timestamp: post.timestamp, ppformat: post.ppformat })"></div>
                </div>
            </main>
    </body>
</html>